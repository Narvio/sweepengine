var G=Object.defineProperty;var u=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var S=(e,o,r)=>o in e?G(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r,b=(e,o)=>{for(var r in o||(o={}))O.call(o,r)&&S(e,r,o[r]);if(u)for(var r of u(o))B.call(o,r)&&S(e,r,o[r]);return e};var a={Standard:"-",Flagged:"?",Revealed:"X"},s={Primary:"Primary",Secondary:"Secondary"},h={[s.Primary]:{[a.Standard]:a.Revealed,[a.Flagged]:a.Flagged,[a.Revealed]:a.Revealed},[s.Secondary]:{[a.Standard]:a.Flagged,[a.Flagged]:a.Standard,[a.Revealed]:a.Revealed}},i={Initial:"Initial",InProgress:"InProgress",GameOver:"GameOver",Completed:"Completed"},y=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],c=-1;var f=(e,o,r)=>{let t=typeof r=="function"?r:()=>r;return Array.from(Array(e),(n,l)=>Array.from(Array(o),(d,m)=>t(l,m)))},g=(e,o,r)=>y.map(([t,n])=>[o+t,r+n]).filter(([t,n])=>t>=0&&n>=0&&t<e.length&&n<e[0].length),p=e=>JSON.parse(JSON.stringify(e));var C=(e,o,r)=>{for(let t=0;t<o;++t){let n,l;do n=Math.floor(Math.random()*e.length),l=Math.floor(Math.random()*e[0].length);while(n===r.row&&l===r.col||e[n][l]===c);e[n][l]=c}},P=e=>{for(let o=0;o<e.length;++o)for(let r=0;r<e[o].length;++r){if(e[o][r]===c)continue;let t=g(e,o,r).filter(([n,l])=>e[n][l]===c).length;e[o][r]=t}},M=(e,o,r)=>{let t=p(e.valueMatrix);return e.gameState.code===i.Initial&&r===s.Primary&&(C(t,e.bombs,o),P(t)),t},x=M;var T=(e,o,r)=>g(e,o,r).filter(([t,n])=>e[t][n]===a.Flagged).length,v=(e,o,r,t)=>{let n=e[r][t],l=o[r][t];n!==a.Flagged&&(e[r][t]=a.Revealed,(l===0||n===a.Revealed&&T(e,r,t)===l)&&g(e,r,t).filter(([d,m])=>e[d][m]!==a.Revealed).forEach(([d,m])=>v(e,o,d,m)))},R=e=>e.reduce((o,r)=>o+r.filter(t=>t===a.Flagged).length,0),j=(e,o,r)=>{let t=p(e.stateMatrix),n=h[r][o.state];return n===a.Revealed&&v(t,e.valueMatrix,o.row,o.col),t[o.row][o.col]=n,t},F=j;var E=(e,o)=>{for(let r=0;r<e.length;++r)for(let t=0;t<e[0].length;++t)if(e[r][t]===a.Revealed&&o[r][t]===c)return[r,t];return null},_=(e,o)=>{let r=!0;return e.forEach((t,n)=>{t.forEach((l,d)=>{r=r&&(e[n][d]===a.Revealed||o[n][d]===c)})}),r},D=(e,o,r)=>{let t={code:i.InProgress,details:null};if(e.gameState.code===i.Initial&&r===s.Secondary)t.code=i.Initial;else{let n=E(e.stateMatrix,e.valueMatrix);n?(t.code=i.GameOver,t.details=n):_(e.stateMatrix,e.valueMatrix)&&(t.code=i.Completed)}return t},I=D;var A=(e,o)=>f(e.length,e[0].length,(r,t)=>{let n=e[r][t],l=o[r][t];return{col:t,row:r,state:n,value:l,isFlagged:n===a.Flagged,isRevealed:n===a.Revealed,isBomb:l===-1,isZero:l===0}}),J=({rows:e,cols:o,bombs:r})=>{let t=f(e,o,a.Standard),n=f(e,o,0),l=A(t,n);return{bombs:r,flags:0,stateMatrix:t,valueMatrix:n,cells:l,gameState:{code:i.Initial}}},N=(e,o,r)=>{let t=b({},e);return t.gameState.code===i.GameOver||t.gameState.code===i.Completed||(t.valueMatrix=x(t,o,r),t.stateMatrix=F(t,o,r),t.gameState=I(t,o,r),t.cells=A(t.stateMatrix,t.valueMatrix),t.flags=R(t.stateMatrix)),t};export{s as ActionType,i as GameState,J as generate,N as nextState};
